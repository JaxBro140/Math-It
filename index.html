<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Math Server Simulation</title>
<style>
  body { font-family: Arial; background:#111; color:#eee; text-align:center; }
  .screen { display:none; padding:20px; }
  .box { background:#222; padding:20px; border-radius:10px; width:350px; margin:auto; }
  input, button, textarea {
    width:100%; padding:10px; margin:8px 0; border-radius:6px; border:none;
  }
  button { background:#2563eb; color:white; cursor:pointer; }
  button:hover { background:#1d4ed8; }
</style>
</head>
<body>

<!-- MAIN MENU -->
<div id="mainMenu" class="screen" style="display:block;">
  <div class="box">
    <h2>Main Menu</h2>
    <button onclick="hostServer()">Host Server</button>
    <input id="joinCodeInput" placeholder="Enter server code">
    <button onclick="joinServer()">Join Server</button>
  </div>
</div>

<!-- HOST CODE POPUP -->
<div id="hostCodeScreen" class="screen">
  <div class="box">
    <h2>Your Server Code</h2>
    <h1 id="hostCodeDisplay"></h1>
    <button onclick="hostContinue()">OK</button>
  </div>
</div>

<!-- HOST ENTER PROBLEMS -->
<div id="hostProblemScreen" class="screen">
  <div class="box">
    <h2>Enter Math Problems</h2>
    <textarea id="problemInput" rows="8" placeholder="One problem per line"></textarea>
    <button onclick="hostSubmitProblems()">OK</button>
  </div>
</div>

<!-- HOST LEADERBOARD -->
<div id="hostLeaderboard" class="screen">
  <div class="box">
    <h2>Leaderboard</h2>
    <div id="leaderboardList"></div>
  </div>
</div>

<!-- PLAYER WAITING -->
<div id="playerWaiting" class="screen">
  <div class="box">
    <h2>Waiting For Host...</h2>
  </div>
</div>

<!-- PLAYER ANSWERING -->
<div id="playerQuestion" class="screen">
  <div class="box">
    <h2 id="questionText"></h2>
    <input id="playerAnswer" placeholder="Your answer">
    <button onclick="submitAnswer()">Submit</button>
  </div>
</div>

<script>
// ---------------------------
// FAKE SERVER STATE
// ---------------------------
let server = {
  code: null,
  problems: [],
  players: {},
  started: false
};

let localPlayerId = null;
let isHost = false;

// ---------------------------
// SCREEN SWITCHER
// ---------------------------
function show(screenId) {
  document.querySelectorAll(".screen").forEach(s => s.style.display = "none");
  document.getElementById(screenId).style.display = "block";
}

// ---------------------------
// HOST FLOW
// ---------------------------
function hostServer() {
  isHost = true;
  server.code = Math.random().toString(36).substring(2, 8).toUpperCase();
  document.getElementById("hostCodeDisplay").textContent = server.code;
  show("hostCodeScreen");
}

function hostContinue() {
  show("hostProblemScreen");
}

function hostSubmitProblems() {
  const text = document.getElementById("problemInput").value.trim();
  if (!text) return;

  server.problems = text.split("\n").map(p => p.trim());
  server.started = true;

  show("hostLeaderboard");
  updateLeaderboard();
}

// ---------------------------
// PLAYER FLOW
// ---------------------------
function joinServer() {
  const code = document.getElementById("joinCodeInput").value.trim().toUpperCase();
  if (code !== server.code) {
    alert("Invalid code");
    return;
  }

  localPlayerId = "player_" + Math.random().toString(36).substring(2, 8);
  server.players[localPlayerId] = { score: 0, index: 0 };

  show("playerWaiting");

  // Poll for host start
  const interval = setInterval(() => {
    if (server.started) {
      clearInterval(interval);
      loadNextQuestion();
    }
  }, 500);
}

function loadNextQuestion() {
  const p = server.players[localPlayerId];
  if (p.index >= server.problems.length) {
    // Finished all questions
    show("mainMenu");
    return;
  }

  document.getElementById("questionText").textContent =
    server.problems[p.index];

  show("playerQuestion");
}

function submitAnswer() {
  const answer = document.getElementById("playerAnswer").value.trim();
  const p = server.players[localPlayerId];
  const problem = server.problems[p.index];

  // Evaluate math expression
  let correct = false;
  try {
    correct = eval(problem) == answer;
  } catch {}

  if (correct) p.score += 10;

  p.index++;
  updateLeaderboard();
  loadNextQuestion();
}

// ---------------------------
// HOST LEADERBOARD
// ---------------------------
function updateLeaderboard() {
  if (!isHost) return;

  const list = document.getElementById("leaderboardList");
  list.innerHTML = "";

  Object.entries(server.players).forEach(([id, data]) => {
    const div = document.createElement("div");
    div.textContent = `${id}: ${data.score} pts`;
    list.appendChild(div);
  });
}
</script>

</body>
</html>
